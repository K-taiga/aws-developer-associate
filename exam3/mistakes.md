## 質問1
>ヘルステックベンチャーB社ではAWS上で体調管理アプリケーションの開発を行っています。このアプリケーションは世界的に使用されており、ユーザーがサブスクリプションで支払いを行っています。開発中の外部連携機能において API gatewayで作成されたパブリックAPIを公開することが必要です。

>この要件を満たすために必要なAPI gatewayの設定を選択してください。

*A: API Gateway使用料プラン*

***
note:

>API Gateway 使用量プランを利用することで、ビジネス要件および予算の制約に合った承認済みのリクエストレートとクォータによって選択した API へのアクセスを許可する設定ができます。これによって、必要に応じて、API のデフォルトのメソッドレベルのスロットリング制限を設定したり、個別の API メソッドのスロットリング制限を設定したりできます。

## 質問2
>あなたの会社はCloudFormationテンプレートを利用してリソースをセットアップしています。 AWSリソースはコードを使用して定義され、条件に基づいてプロビジョニングされます。 あなたはエンジニアとして、適切な条件設定をコード化して、CloudFormationテンプレートを準備しています。

>CloudFormationテンプレートで条件を評価するためのセクションを選択してください。

*A: Parametersセクション*

***
note:

* Parametersセクションで条件がtrueの場合にリソースを作るといったことができる

>CloudFormationの各セクションは次のような内容を担っています。<br>
Parametersセクション：
条件において評価する入力を定義します。これらの入力パラメータの値に基づいて、条件は true または false と評価されます。条件で擬似パラメータを評価する場合は、このセクションで擬似パラメータを定義する必要はありません。擬似パラメータはCloudFormation によって事前定義されています。 <br>
Conditionsセクション<br>
組み込み関数を使用して条件を定義します。これらの条件はCloudFormation が関連するリソースをいつ作成するかを指定します。 <br>
Resources および Outputsセクション<br>
条件付きで作成するリソースまたは出力と条件を関連付けます。CloudFormation は、true に関連付けられたエンティティを作成し、false に関連付けられたをエンティティを無視します。Condition キーと条件の論理 ID を使用して、リソースまたは入力と関連付けます。条件付きでプロパティを指定するには、Fn::If 関数を使用します。

## 質問5
>あなたはAWS開発者として社内のアプリケーション開発に携わっています。現在は、オンプレミス環境のLinuxサーバーで実行されるJAVAアプリケーションを開発しています。アプリケーションは、AWS SDK for JAVAを使用して、オンプレミス環境からS3、DynamoDB、RDSなどと連携する必要があります。

>このアプリケーション開発に必要な開発者へのアクセス権限設定として、最も適切な方法を選択してください

*A: 開発者に必要なAWSサービスへのアクセス権限を付与したIAMユーザーを作成する。次にアプリケーションサーバーでIAMユーザーのアクセススキーを使用して~/.aws/credentialsに認証ファイルを作成する*

***
note:

* オンプレミスからのためロールだけ与えてもダメ
* IAMユーザーのIDとSecretをcredentialsに入れるとアクセスできる

## 質問8
>あなたはソリューションアーキテクトとして、ECサイトを構築しています。このサイトはEC2インスタンスにAuto Scalingグループを適用して構成されており、データベースとしてAmazon Aurora PostgreSQLを使用しています。 このデータベース処理では次のように処理を分ける必要があります。

>１．プロダクショントラフィックの書き込み操作は大容量インスタンスが処理<br>
２．社内スタッフが管理用におこなったレポートクエリは小容量インスタンスが処理

>この要件を満たすために、アプリケーションとAuroraデータベースクラスタの最適な構成を選択してください。

*A: Auroraで新しいカスタムエンドポイントを作成して、両方のトラフィックを処理できるように構成する*

***
note:

* 新たにカスタムエンドポイントを作成して元のエンドポイントと合わせて２つの接続で処理をする

>Amazon Auroraは通常、単一のインスタンスではなくDBインスタンスのクラスターを構成します。 各接続は特定のDBインスタンスによって処理されます。 Auroraクラスターに接続すると、指定したホスト名とポートはエンドポイントと呼ばれる中間ハンドラーを指します。 Auroraはこれらの接続を抽象化するためにエンドポイントメカニズムを使用します。これを使って、Auroraで新しいカスタムエンドポイントを作成して、両方のトラフィックを処理できるように構成することが可能です。

## 質問10
>あなたはAWSを利用してサーバレスアプリケーションを構築している開発者です。Lambda関数をAWSにデプロイするためにCloudFormationテンプレートを作成しています。 CloudFormaitonテンプレートにコードを配置するためにAWS :: Lambda :: Functionリソースのパラメーター設定が必要です。

>どのようなパラメーター設定をするべきでしょうか？

*A: ZipFile*

***
note:

* Lambda 関数のデプロイパッケージでは、Amazon S3 内のオブジェクトの場所を指定できる
* AWS CloudFormationはLambdaをS3のindexという名前のファイルに配置し、zip化して展開パッケージを作成する

## 質問12
>A社ではAWSのサーバレスアーキテクチャを活用した処理の自動化を行っています。あなたはAWS開発者として、Amazon API Gatewayによって起動されるAWS Lambda関数を開発しており、新APIバージョンをテストしたいと考えています。

>Lambda関数の既存バージョンと並行して、新バージョンを上手くテストする方式はどれでしょうか？

*A: エイリアスを利用してAPI Gatewayのカナリアリリースを実施する*

***
note:

>新しいバージョンがCanaryリリースとしてデプロイされると、以前のベースバージョンは同じステージで通常のオペレーションのために、本稼働版としてデプロイされたままになります。エイリアスには Additional versionというオプションが存在し、主として指定したVersionとは異なるVersionとその呼び出し割合を指定することができます。

## 質問13
>あなたはエンジニアとして、AWS Lambda、API Gateway、およびDynamoDBを単一のスタックで構成したサーバーレスアーキテクチャの初期展開の準備をしています。API GatewayとLambdaとを連携するためにはAPI Gatewayにステージを追加して、Lambda関数の環境設定を関連付けることが必要です。

>これを実現するには、 Lambda 関数のどの設定を追加する必要がありますか？ （2つ選択してください。）

*A: ステージ変数、Lambdaエイリアス*

***
note:

* API Gatewayで指定したバージョンのステージ変数とLambdaのエイリアスであるprodやdevがどのバージョンなのかを紐付ける設定をする

>Lambda 関数では 1 つ以上のエイリアスを作成できます。AWS Lambda エイリアスは Lambda 関数の特定のバージョンに対するポインタのようなものです。エイリアスを使用すると、新しいLambda関数バージョンを昇格させるプロセスを抽象化でき、新しいバージョンよりも管理しやすくなります。 したがって、Lambda エイリアスを設定することで、Lambda 関数の特定のバージョンを認識することができ、バージョンを一致させることができるようなります。

>API Gatewayのステージ変数は、REST API のデプロイステージと関連付けられた設定属性として定義できる名前と値のペアです。環境変数と同様に機能し、API のセットアップやマッピングテンプレートで使用できます。たとえば、ステージ設定でステージ変数を定義し、REST API のメソッド用に、HTTP 統合の URL 文字列を値として設定できます。これによって、API のセットアップから関連するステージの変数名を使用して URL 文字列を参照できます。これによって、ステージ変数の値に対応する URL をリセットすることで、各ステージで異なるエンドポイントとともに同じ API セットアップを使用することができます。AWS Lambda には AWS Lambda エイリアスを利用してパラメーターが渡されます。

## 質問14
>あなたはLambda 関数で取り扱うデータを暗号化する設定を行っています。暗号化にはAWS KMSを使用してネットワーク経由で転送される大きなJSONファイルを暗号化し、本番に進む前にアプリケーションをテストしたいと考えています。これには適切なKMSのデータサイズに基づいた設定が必要となります。 

>AWS KMSの最大データサイズを選択してください。

*A: 4KB*

***
note:

* 暗号化オペレーションに AWS KMS カスタマーマスターキー (CMK) を使用しますが、KMSは4 KB (4096 bytes) 以上のデータを受け付けない

## 質問15
>企業はAWS上でCodeシリーズを利用してCI / CD開発環境を整備して、アプリケーションを構築しています。アプリケーションはCodeDeployによって最適な展開方式を設定しています。デプロイ中に失敗し、AWS CodeDeployの処理がロールバックされました。 

>ロールバック時のデプロイIDは次のうちどれですか？

*A: 新しいデプロイID*

***
note:

>以前にデプロイされたアプリケーションのリビジョンを新しいデプロイとして再デプロイすることによって、デプロイをロールバックします。これらのロールバックされたデプロイは、前のデプロイのバージョンを復元するのではなく、新しいデプロイ ID を使用する技術的に新しいデプロイです。 

## 質問17
>あなたはAWS専門のエンジニアとして、車両データをキャプチャしてAmazon Kinesis Data Streamsに送信するモバイルアプリを構築しています。アプリでデータ呼び出しを実行したところ、ProvisionedThroughputExceededExceptionエラーで拒否されてしまいました。調査したところKinesis側のストリーム処理としては問題ないパフォーマンスが担保されており、ストリーム処理されたデータを連携する処理において問題が発生しているようです。

>この問題に対して、コストを最小限に抑えつつ実施できる対応策を選択してください 。（2つ選択してください。）

*A: エクスポネンシャルバックオフの実施、Lambdaによるバッチ並行処理の利用*

***
note:

* ProvisionedThroughputExceededExceptionエラーは、大量のデータを処理できていない
* PutRecord要求を処理できない場合か、またはその後のGetRecord処理に対応するパフォーマンスがない
>エクスポネンシャルバックオフは、再試行間の待機時間を累進的に長くして、連続的なエラー応答を受信するという考えに基づいています。最大遅延間隔で最大回数の再試行を実行する必要があります。再試行の最大遅延間隔と最大回数は必ずしも固定値ではなく、実行する操作や局所的な要因 (ネットワークのレイテンシーなど) に基づいて設定する必要があります。

>KinesisのGetRecord処理をする際にデータをとりだす単位をバッチと呼んでいます。その際のバッチ処理を高速分散化させることで、エラーを回避させることができます。ProvisionedThroughputExceededExceptionエラーへの対処として、データレコードを取得するバッチのサイズを変更したり、バッチ処理を並行化することでGetRecordの要求増に対応することができるようになります。

## 質問18
>B社ではAPIコールでDynamoDBテーブルからデータを取得するサーバレスアプリを実装しています。あなたはサーバレスエンジニアとして、開発環境でAPIに取り組んできましたが、行った変更はAPIに反映されていないようです。 

>変更をAPIに反映させるために必要な手順を選択してください。

*A: ステージへのデプロイ*

***
note:

* ステージはデプロイへの名前を付けたリファレンスであり、 API のスナップショット
* ステージを使用してテストのために Canary リリースを行ったりできる
* API Gatewayはメソッドの変更、統合、承認者、およびステージ設定以外のものを含むAPIを更新するたびに、既存のステージまたは新しいステージにAPIを再デプロイする必要があります。 APIが進化するにつれて、APIのさまざまなバージョンとしてさまざまな段階にデプロイし続けることになる

## 質問19
>あなたはAWSを得意としたアプリケーション開発エンジニアです。現在は先月リリースしたAWS Lambda関数の不具合の改修や新規リリース向けの追加開発を実施しています。不具合の確認にはX-Rayを利用しています。X-Rayにデータを送信するために、Lambda関数にアタッチされたIAMロールを変更して、Lambda関数にX-Rayの実行に必要なアクセス権限を付与しましたが、X-Ray SDKを適用して挙動テストを実施したところ、データがX-Rayに送信されませんでした。

>この問題の原因として可能性が高い内容を選択してください。

*A: Lambda X-Rayトレースが有効化されていない*

***
note:

* 今回はすでにX-Rayは設定されており、デーモンは起動ずみ
* Lambda X-Ray トレースが有効化されていないと、データがX-Rayに送信されない
* Lambda関数でトレースを有効にするには、Lambda関数の実行ロールにトレース許可を追加する

## 質問21
>あなたはElastic Beanstalkを利用して、WEBアプリケーションを展開しています。先日、このWEBアプリケーションの処理が遅延しているというクレームが業務担当者からよせられました。障害解析をしてみると、CPUの利用率が100％かそれに近い水準まで上昇していることがわかりました。

>この問題を解決する方法を選択してください。

*A: CPUをモニタリングしたElastic Beanstalkのオートスケーリングを設定する*

***
note:

> Elastic Beanstalkには環境内の Amazon EC2インスタンスを管理する Auto Scaling グループを設定することができます。単一インスタンス環境では、Auto Scaling グループに対して常に1 つのインスタンスが実行されます。負荷分散される環境では、実行する範囲のグループを設定すると、Auto Scalingは負荷に基づき必要に応じてインスタンスを追加または削除します。

* CloudWatchイベントによりモニタリングしたCPU状態に応じた通知を行うことが出来るが、スケーリングを実施するわけではない。

## 質問25
>あなたはサーバレスを得意とした開発者としてA社で勤務しています。現在、A社ではAWS CloudFormationを使用してLambdaをアップロードおよび更新する設定を行っています。

>CloudFormationにおいてLambda関数を設定する方法を選択してください。（2つ選択してください。）

*A: Lambda関数コードをzip化してS3にアップロードし、CloudFormationのAWS::Lambda::Functionにおいて参照する*<br>
*依存関係がない場合は、CloudFormationのAWS::Lambda::FunctionにLambda関数コードを記述する*

***
note:

* Lambdaに置かれたコードをそのままCloudFormationでは参照できず、zip化してS3に置いて参照する必要がある
* またCloudFormationに直接Lambdaを書けるのは、依存関係がない場合のみ！

## 質問28
>B社はAmazon SQSを利用した顧客からのリクエストを処理するアプリケーションを開発しています。Client_idごとにメッセージ順序が前後しないようにキューを処理するために、FIFOキューを選択しました。 あなたはエンジニアとして、FIFOキューの順序を保証する設定を依頼されました。

>次の中から、どのメッセージパラメータの値をClient_idに設定する必要がありますか？

*A: メッセージグループID*

***
note:

* メッセージグループ ID は 特定のメッセージグループに属するメッセージを指定するタグ
* 同じメッセージグループに属するメッセージは、メッセージグループに相対的な厳密な順序で、常に 1 つずつ処理されFIFOが実現できる

## 質問29
>あなたはS3に格納してある大量の顧客リストに対して、リストコマンドを実行しましたが、ページサイズが大きすぎてエラーが発生してしまいました。対応として、使用するAPIコール数を最小限に抑えてページ数を区切ることが必要です。したがって、S3から出力されるリスト結果をページ分割するCLIコマンドを実行します。

>どのCLIオプションを使用する必要がありますか？ （2つ選択してください。）

*A: --max-items,--page-size*

***
note:

* デフォルトでは、AWS CLI は 1,000 のページサイズを使用して、利用可能な全ての項目を取得する
* --max-items で項目数の指定、--page-sizeでAWS CLI が AWS のサービスの 1 回の呼び出しで要求する項目数を少なくすることができる
* --page-sizeを指定して細かく呼び出すことでエラーを回避する

## 質問30
>B社ではAWSを利用したCI/CD環境を構築しています。開発環境はCodeDeployを使用して、EC2インスタンスにアプリケーションをデプロイします。デプロイプロセスでは、appspec.ymlファイルを使用してデプロイフックを指定して、ライフサイクルイベントを設定して、適切なイベント処理を実行することが求められています。イベント要件として、デプロイされるLambda関数バージョンがシフトする前に、SNSによって通知を実施するタスクを設定する必要があります。

>どのデプロイのライフサイクルイベントを構成する必要がありますか？

*A: BeforeAllowTraffic*

***
note:

* BeforeAllowTrafficというライフサイクルイベントを利用すると、トラフィックがデプロイされたLambda関数バージョンに移行する前にタスクを実行する
* つまりデプロイしてTrafficが来る前に実行するタイミングなので、Lambda関数バージョンがシフトする前にSNSによって通知を実施するタスクを設定するといのに合致する

>■BeforeAllowTraffic
トラフィックがデプロイされたLambda関数バージョンに移行する前にタスクを実行するために使用します。

>■ValidateService
デプロイが正常に完了したことを確認するために使用されます。

>■BeforeInstall
インストール前にタスクを実行するために使用する

>■AfterAllowTraffic
トラフィックがデプロイされたLambda関数バージョンに移行する後にタスクを実行するために使用します

## 質問31
>A社はAWSのサーバレスアーキテクチャを社内で新規採用することになり、AWS Lambda、API Gateway、およびDynamoDBを単一のスタックで構成した新しいサーバーレスアーキテクチャを実装することになりました。あなたはエンジニアとして、OAuthまたはSAMLに類似した認証方式によってAPIリクエストへの認証を提供し、APIへのアクセスを制御する設定を行っています。

>この要件を達成するため最適な方法を選択してください。

*A: トークンベースのLambdaオーソライざー*

***
note:

* Lambda オーソライザーは、Lambda 関数を使用して API へのアクセスを制御する API Gateway の機能 2種類ある

>■トークンベース の Lambda オーソライザー (TOKEN オーソライザーとも呼ばれる)<br>
JSON ウェブトークン (JWT) や OAuth トークンなどのベアラートークンで発信者 ID を受け取ります。

>■リクエストパラメータベースの Lambda オーソライザー (REQUEST オーソライザーとも呼ばれる)<br>
ヘッダー、クエリ文字列パラメータ、stageVariables、および $context 変数の組み合わせで、発信者 ID を受け取ります。 

## 質問33
>ある企業ではEC2インスタンスにホストされているWebアプリケーションを運用しています。 あなたはソリューションアーキテクトとして、現在このアプリケーションに対して、EC2インスタンスのパブリックIPアドレスとプライベートIPアドレスを必要とするシェルスクリプトを作成しています。

>シェルスクリプトで使用できるインスタンスの関連IPアドレスを取得する最良の方法を選択してください。

*A: CurlまたはGetコマンドを利用して、169.254.169.254/latest/meta-data/から直近のメタデータを取得する*

***
note:

> インスタンスメタデータは実行中のインスタンスから取得できるため、Amazon EC2 コンソールまたは AWS CLI を使用する必要はありません

> IP アドレス 169.254.169.254 は、リンクローカルアドレスで、インスタンスからのみ有効です。したがって、CurlまたはGetコマンドを利用して、169.254.169.254/latest/meta-data/から直近のメタデータを取得する

## 質問34
>A社ではS3を利用したデータ共有システムを構築しています。セキュリティ要件としてデータ暗号化が必須となっており、あなたはエンジニアとして、クライアントが提供する暗号化キー（SSE-C）を使用したサーバーサイド暗号化をS3バケットに実装しています。このS3バケットにデータを適切にアップロードするには、リクエストにヘッダーを含める設定が必要です。

>この要件に対応して設定するべきヘッダーを選択してください。（3つ選択してください。）

*A: x-amz-server-side-encryption-customer-key-MD5*<br>
*x-amz-server-side-encryption-customer-key*<br>
*x-amz-server-side-encryption-customer-algorithm*

***
note:

* S3にあげるときに暗号化キーを使用して暗号化するには、暗号化キーの情報を指定するために3つのリクエストヘッダーを使用する

>■x-amz-server-side​-encryption​-customer-algorithm<br>
暗号化アルゴリズムを指定するには、このヘッダーを使用します。ヘッダーの値は "AES256" である必要があります。 

>■x-amz-server-side​-encryption​-customer-key<br>
Amazon S3 でデータを暗号化または復号するために使用する base64 でエンコードされた 256 ビットの暗号化キーを指定するには、このヘッダーを使用します。 

>■x-amz-server-side​-encryption​-customer-key-MD5<br>
RFC 1321 に従って、暗号化キーの base64 エンコードされた 128 ビット MD5 ダイジェストを指定するには、このヘッダーを使用します。Amazon S3 では、このヘッダーを使用してメッセージの整合性を調べて、送信された暗号化キーにエラーがないことが確認されます。 

## 質問35
>A社では開発環境などは全てDocker形式で展開できるようにAmazon ECSを使用してDockerアプリケーションを構築しています。このアプリケーションではFargate起動モードを使用しています。アプリケーションには３つの異なるタスクがあり、各タスクは他のタスクとは異なるさまざまなAWSリソースにアクセスします。

>ECSに対するAWSリソースへのアクセス許可設定として最適な設定を選択してください。

*A: 3つのIAMロールを作成して、各タスクで使用するAWSリソースへの許可をそれぞれ設定し、3つのECSタスクに設定する*

***
note:

* タスクの分割はタスク定義で実施するのではなく、IAMロールを分割することで実施可能

## 質問36
>ある会社ではAWS Lambda、API Gateway、およびDynamoDBを単一のスタックで構成した新しいサーバーレスアーキテクチャを構築しています。アプリケーションの実装においては、LambdaをAPI Gatewayと統合して、GetCustomerリソースによるGETメソッドを公開してLambda関数を呼び出し、コンシューマーがJSON形式でDynamoDBからデータリストを取得します。その際のAPIリクエストにはクエリ文字列パラメーターを含める必要があります。

>この要件を達成するための最適な設定方法を選択してください。

*A: リソースのメソッドリクエストをセットアップする*

***
note:

* API Gatewayは入口なだけのため、HTTP等できたものを裏で実行できるようにするのとクライアントに返すレスポンスを定義する必要がある

>新しいまたは選択された API Resource の固有の HTTP 動詞になる API メソッド リソースを作成する場合、以下のサブタスクの実行が必要となります。<br>
・HTTP メソッドをメソッドリクエストに追加する<br>
・リクエストパラメーターを設定する<br>
・リクエストボディのモデルを定義する<br>
・認証スキームを実行する<br>
・リクエストの検証を有効化する

## 質問37
>A社は顧客管理アプリケーションをAWSを利用して構築しています。これらはWEBサーバーとしてEC2インスタンスを利用して、ストレージとしてAmazon S3を使用して構成されています。EC2インスタンスには、開発と本番の両方のS3バケットにデータを保存するためのIAMロールが割り当てられています。また、このEC2インスタンスにはリソースアクセス用のAWS CLIもインストールされています。しかしながら、このEC2インスタンスが本番のS3バケットにアクセスできないように以下のように設定変更することになりました。<br>
>【EC2インスタンスの設定変更】<br>
>本番用と開発用のS3バケットへのIAMロールの設定　→　開発用のS3バケットへのIAMロールの設定<br>
>このEC2インスタンスが設定変更後も両方のバケットにデータを保存できてしまうようです。<br>
この問題を解決する方法を選択してください。

*A: AWS CLIで設定されたIAMロールを削除する*

***
note:

* EC2にはS3へのIAMロールとCLIでS3をアクセスするIAMロールがあって、そっちが削除されていないためアクセスできてしまう

>該当するEC2インスタンスにはIAMロールとAWS CLIの両方がアタッチされています。 インスタンスプロファイルロールは、開発環境にのみアクセスするように更新されていますが、インスタンスで実行されているアプリケーションは、AWS CLIにアタッチされているアクセス認証情報または古いIAMロールを使用する場合があるため、これを削除することが必要です。

## 質問38
>B社ではマイクロサービスアーキテクチャのアプリケーションを構築しています。現在構築しているアプリケーションはX-Rayによるトレースを実施して、リクエストデータを収集してます。あなたは運用管理者として、X-Rayトレースデータをデバックアプリケーション上に表示することができるツールを機能追加しています。

>この要件に合致したツールのセットアップ方法は次のうちどれですか？（2つ選択してください。）

*A: GetTraceSummaries APIを使用してアプリケーションのトレースIDのリクエストを取得する*<br>
*BatchGetTraces APIを使用してトレースのリストを取得する*

***
note:

* GetTraceSummaries API<br>
指定した時間枠内でFilterを適用した結果、使用可能なトレースのIDと注釈を取得。<br>
フィルターで指定した注釈キーがあるトレースを検索することができる。

* BatchGetTraces APIを使用してトレースの中身のリストを取得する

>X-Ray のトレースセグメントは、アプリケーションが対応するリクエストの JSON 表現です。トレースセグメントは、元のリクエストに関する情報、アプリケーションがローカルで実行する作業に関する情報、およびアプリケーションが AWS リソース、HTTP API、SQL データベースに対して行うダウンストリーム呼び出しに関する情報のサブセグメントを記録します。   セグメントドキュメントは、セグメントに関する情報を X-Ray に伝えます。セグメントドキュメントは最大で 64 kB とし、サブセグメントを含むセグメント全体、リクエストが進行中であることを示すセグメントのフラグメント、または別個に送信される単一のサブセグメントを含むことができます。セグメントドキュメントは、PutTraceSegments API を使用して直接 X-Ray に送信できます。 

>X-Ray はセグメントドキュメントをコンパイルおよび処理し、それぞれ GetTraceSummaries API と BatchGetTraces API を使用してアクセスできる、クエリ可能なトレースサマリとトレース全体を生成します。このサービスは、X-Ray に送信するセグメントとサブセグメントに加えて、サブセグメントの情報を使用して推測セグメントを生成し、トレース全体に追加します。推定セグメントは、サービスマップのダウンストリームサービスとリソースを表します。

## 質問39
>A社ではマイクロサービスアーキテクチャのアプリケーションを構築しています。アプリケーションはX-Rayによるトレースを実施して、アプリケーションが提供するリクエストの全データを収集しています。あなたはエンジニアとして、PutTraceSegments APIを使用して、セグメントドキュメントをX-Rayに直接送信するカスタムコードを開発しています。

>このタスクを達成するためには、セグメントドキュメントに何を含める必要がありますか？

*A: サブセグメント*

***
note:

* X-Rayに特定のログを送りたい場合はPuTtraceSegments APIを使用してサブセグメントを利用して送る必要がある

>PutTraceSegments APIを使用して、セグメントドキュメントをX-Rayに直接送信するカスタムコードを開発するためには、サブセグメントを利用する必要があります

>X-Ray はサブセグメントを作成して、AWS のサービスと AWS SDK で作成するリソースへの呼び出し、内部または外部 HTTP ウェブ API への呼び出し、あるいは SQL データベースクエリの呼び出しを記録することができます。また、サブセグメントを作成してアプリケーションでコードブロックをデバッグしたり、注釈を付けたりできます。

>サブセグメントには他のサブセグメントを含めることができるため、内部関数呼び出しに関するメタデータを記録するカスタムサブセグメントには、他のカスタムサブセグメントおよびダウンストリーム呼び出し用のサブセグメントを含めることができます。 X-Rayはサブセグメントを使用して、PutTraceSegments APIを使用して、セグメントドキュメントをX-Rayに直接送信するなどの設定が可能です。

## 質問40
>A社はモバイルゲームアプリケーションを構築しています。このアプリケーションは複数のデバイスプラットフォームをサポートしており、認証サービスが必要です。 ソーシャルメディアログインで認証されたユーザーに加えて、認証を必要としないゲストユーザーに一時認証情報を提供する仕組みを実装する必要があります。

>ゲストユーザーに一時認証情報を提供するための最適なソリューションを選択してください。

*A: Coginito IDプールを使用してから、認証されていないIDヘのアクセスを有効にする*

***
note:

* ゲストユーザーのログインはIDプール
* ソーシャルログインはユーザープール

>Amazon Cognito ID プールは、ゲストユーザー (未認証) と認証してトークンを受け取ったユーザーに一時的な AWS 認証情報を提供します。ID プールはアカウントに固有のユーザー ID データのストアです。  Amazon Cognito ID プールは、ID プロバイダーを使って認証を行わないユーザー用に、一意の識別子や AWS 認証情報を提供して、認証されていない ID をサポートできます。アプリケーションで、ログインしないユーザーを許可している場合、認証されていない ID 用にアクセスを有効にできます。次のようなケースにAmazon Cognito ID プールを使用します。<br>
■S3バケットや Amazon DynamoDB テーブルなどの AWS リソースへのアクセスをユーザーに許可する。<br>
■未認証ユーザー用の AWS 認証情報を一時的に生成する。

>ユーザプールは Amazon Cognito のユーザディレクトリです。ユーザープールを使用すると、ユーザーは Amazon Cognito を通じてウェブまたはモバイルアプリにログインできます。また、ユーザーは Google、Facebook、Amazon などのソーシャル ID プロバイダー、および SAML ベースの ID プロバイダー経由でユーザープールにサインインすることもできます。これは通常のユーザー認証に利用するものですのでゲストユーザー用ではないため不正解

## 質問42
>B社のWEBサービスでは、人事データを管理するためにDynamoDBにCustomerテーブルを作成しています。あなたはエンジニアとして、このテーブルから必要なデータを取得するべくクエリ処理の実装を行っています。要件としては、顧客の口コミ投稿データを過去１年間にわたって、１カ月ごとに検索できることが求められています。

>このデータ分析機能を実装する方法を選択してください。

*A: ローカルセカンダリインデックスを作成し、クエリ操作を使用して、投稿時間をソートキーとして利用する*

***
note:

* DynamoDBではプライマリキーとは別にセカンダリーキーを設定するメリットがある
* 特定のテーブルへの抽出にはローカルセカンダリインデックスを使う

>Amazon DynamoDB は、プライマリキーの値を指定して、テーブルの項目への高速なアクセスを可能にします。しかし多くのアプリケーションではプライマリキー以外の属性を使って、データに効率的にアクセスできるようにセカンダリ（または代替）キーを 1 つ以上設定することで、メリットが得られることがあります。これに対応するために、1 つのテーブルで 1 つ以上のセカンダリインデックスを作成して、それらのインデックスに対して Query または Scan リクエストを実行することができます。セカンダリインデックスには２つの種類があります。

>■グローバルセカンダリインデックス<br>
ベーステーブルと異なるパーティションキーとソートキーを持つインデックスです。グローバルセカンダリインデックスは、そのインデックスのクエリは、すべてのパーティションにわたって、ベーステーブルのすべてのデータを対象に実行できるので、「グローバル」と見なされます。アプリケーションによっては、さまざまな属性をクエリ基準に使用して、いろいろな種類のクエリを実行する必要があります。このような要件に対応するために、1 つ以上のグローバルセカンダリインデックスを作成して、Amazon DynamoDB でそのインデックスに対して Query リクエストを発行できます。 

>■ローカルセカンダリインデックス<br>
ベーステーブルと同じパーティションキーと、異なるソートキーを持つインデックスです。ローカルセカンダリインデックス内部のすべてのパーティションの範囲が、同じパーティションキーの値を持つベーステーブルパーティションに限定されるという意味で「ローカル」です。ベーステーブルのプライマリキーを使用してデータのクエリを実行する必要があるのは、一部のアプリケーションだけです。ただし、代替のソートキーが役に立つ場合があります。アプリケーションにソートキーという選択肢を提供するために、Amazon DynamoDB テーブルに 1 つ以上のローカルセカンダリインデックスを作成して、それらのインデックスに対して Query または Scan リクエストを実行できます。 Scan リクエストの場合は全てのデータをとってくるため、特定のデータを取得するにはQuery リクエストを指定します。これにより、ローカルセカンダリインデックスを作成し、クエリ操作を使用して、投稿時間をソートキーとして利用することが可能です

## 質問44
>開発者はAPI GatewayとLambda関数とDynamoDBを連携させたモバイルアプリケーションを開発しています。これにはAPI Gatewayとの合理化された統合セットアップが必要です。 要件は、HTTPSを介してクライアントからの着信要求をバックエンドLambda関数への入力値として渡すことです。

>この要件を満たすために最適な統合方式を選択してください。

*A: Lambdaプロキシ統合*

***
note:

* API GatewayでHTTPSを入り口としてバックエンドに値を渡す場合はLambdaプロキシ統合を使う
* Lambda 非プロキシ統合はより複雑なマッピングを定義したい場合に利用する

>Lambda 非プロキシ統合では、プロキシ統合のセットアップ手順に加えて、受信リクエストデータがどのように統合リクエストにマッピングされるか、統合レスポンスデータの結果がメソッドレスポンスにどのようにマッピングされるかを指定する統合方式となります。この統合方式では、API Gatewayを利用してLambdaを呼び出す際に、HTTPリクエストに含まれている情報を連携するために、わざわざMapping Templateを作成して、HTTPヘッダーなどをeventオブジェクトに設定する必要があり、今回の要件には向いていません。Lambda 非プロキシ統合はより複雑なマッピングを定義したい場合に利用することになります。

## 質問45
>A社はAPI GatewayとLambda関数とDynamoDBを連携させたモバイルアプリケーションを開発しています。開発チームは API GatewayでAPIキャッシュを有効にして、アプリケーションの読み取りパフォーマンスを改善したところです。あなたは開発メンバーとして、このAPIの一定期間内にバックエンドから提供されたリクエスト数をモニタリングしてキャッシュ処理が問題なく実行されているかをトレースする設定を任されました。

>この要件を達成するためのCloudWatchのメトリックスを選択してください。

*A: CacheMissCount*

***
note:

* バックエンドに何回行ってるかを見たいからCacheMissCount

>デフォルトでは、API Gateway メトリクスデータは 1 分間隔で CloudWatch に自動的に送信されます。以下のリストはメトリクスの一般的な利用方法となります。

>・バックエンドの応答性を測定するため、[IntegrationLatency] メトリクスをモニタリングします。<br>
・API コールの全体的な応答性を測定するために、Latency メトリクスをモニタリングします。<br>
・目的のパフォーマンスの実現に向けてキャッシュ容量を最適化するために、指定された期間内に API キャッシュから配信されたリクエストの数には、 CacheHitCountと CacheMissCount メトリクスをモニタリングします。<br>
・CacheHitCountは指定された期間内に API キャッシュから配信されたリクエスト数<br>
・CacheMissCount はAPI キャッシュが有効になっている特定の期間における、バックエンドから提供されたリクエスト数

## 質問47
>あなたはCodeCommitを利用したgit処理によって開発を進めていく準備をしています。各開発者はローカルPCからCodeCommitにアクセスしてgitpushなどの処理を行います。したがって、開発者に対するCodeCommitへのアクセス許可設定により、ローカルコンピューター上のコードリポジトリを利用するためのアクセス制御を設定しています。

>開発者にCodeCommitへのアクセスを許可する方法を選択してください。 （2つ選択してください。）

*A: 新しいSSHキーを生成し、公開SSHキーを開発者の各IAMユーザーに関連づける*<br>
*HTTPS Git認証情報を設定する*

***
note:

>開発者にCodeCommitアクセスを適切に付与するにはIAMポリシーを利用してCodeCommitへのアクセス許可権限を付与するのではなく、HTTPS Git認証情報を生成し新しいSSHキーを生成し公開SSHキーを開発者の各IAMユーザーに関連付ける必要があります

## 質問48
>A社はAWSのサーバレスアーキテクチャを社内で新規採用することになり、オンプレミスデータセンターでホストされるWEBアプリケーションをLambdaとAPI Gatewayを使用してAWSに移行したいと考えています。既存アプリケーションはOpenAPIを使用して、RestAPI形式でAPI連携を実施しており、この形式をAWSでも実装することが求められています。したがって、Swagger定義からリソースとメソッドを取り込む対応が必要となります。

>API Gatewayを利用してこのタスクを達成する最適なソリューションを選択してください。

*A: AWSコンソールを使用してSwaggerまたはOpenAPI定義をAPI Gatewayにインポートする*

***
note:

* 新しいAPIを追加したい場合にはAPI のインポート機能でSwagger API定義を貼り付け、SwaggerまたはOpenAPI定義からのリソースとメソッドを入力すると追加できる

>API Gateway の API のインポート機能を使用して、外部の定義ファイルから REST API を API Gateway にインポートすることができます。API のインポート機能では OpenAPI v2.0 および OpenAPI v3.0 定義ファイルがサポートされています。新しい定義で上書きして API を更新したり、既存の API で定義をマージしたりします。リクエスト URL で mode クエリパラメータを使用して、オプションを指定します。AWSコンソールにSwagger API定義を貼り付けて、新しいAPIを作成し、SwaggerまたはOpenAPI定義からのリソースとメソッドを入力できます。

## 質問49
>開発者はLambda関数とDynamoDBを連携させたモバイルアプリケーションを開発しています。セキュリティ要件として、データベース認証情報を暗号化して保護した上で、安全に共有する対応が必要です。 

>このタスクを達成する最適なソリューションを選択してください。

*A: AWS Systems Managerパラメータストアを利用する*

***
note:

* AWSではAWS Systems Manager パラメータストアでは認証情報やアクセスキーを暗号化し保持できる
* Git等にアクセスキーをあげちゃうインシデントをなくすために、AWS内でパラメータとして利用できるようにしたもの
* 似たようなサービスにSecrets Managerもあるが有料だがこっちのが新しい
* KMSはただの暗号化をするためのサービス　環境変数とかを認証情報を保持するものではない

>パラメータストア には、以下のような利点と特徴があります。 <br>
■セキュアでスケーラブルな、ホストされたシークレット管理サービスを使用します<br>
■コードからデータを分離してセキュリティ体制を改善します。<br>
■設定データとセキュリティ文字列を階層内に保存し、バージョンを追跡します。<br>
■きめ細かいレベルでアクセスの制御と監査を行います。<br>
■パラメータとパラメータポリシーの両方について、変更通知を設定し、自動化されたアクションをトリガーします。<br>
■パラメータに個別にタグを付け、運用、パラメータ、Amazon EC2 タグ、パスレベルなどのさまざまなレベルからのアクセスを保護します。<br>
■ パラメータストア パラメータを使用して、中央のストアからシークレットおよび設定データを取得します。

## 質問51
>組織はAWSとオンプレミスの両方を利用してエンタープライズアーキテクチャを設計し、様々なアプリケーションを運用しています。これらのアプリケーションではオンプレミス環境との統合的なアクセスが必要なため、 ユーザーはSAML 2.0 によるエンタープライズ ID プロバイダーを使用してサインインすることが求められています。

>要件を満たすのに役立つソリューションは次のうちどれですか？（2つ選択してください。）

*A: IDフェデレーションとCognitoの統合を有効にする*<br>
*AWS Single Sign-OnによりOrganizationsの全てのアカウントへのSSOアクセスとユーザーアクセス権限の一元管理を実行する*

***
note:

* IDフェデレーションはオンプレミスからAWSへのアクセスを許可するための仕組み　そのためにSAML 2.0 によるエンタープライズ ID プロバイダーで認証を行う
* IDフェデレーションとCognitoを連携することで簡単にユーザーがアプリにサインイン、サインアップ、アクセスコントロールの設定を追加できる

>AWS Single Sign-On によりOrganizations のすべてのアカウントへの SSO アクセスとユーザーアクセス権限の一元管理を実行することができます。AWS Single Sign-On (SSO) は、複数の AWS アカウントやビジネスアプリケーションへの SSO アクセスを簡単に一元管理できるクラウド SSO サービスです。これにより、ユーザーは AWS SSO で構成する資格情報か既存の社内認証情報を使用してユーザーポータルにサインインし、割り当てられたすべてのアカウントとアプリケーションに 1 か所からアクセスできます。AWS SSO では、社内の既存の Microsoft Active Directory (AD) の ID を使用して、アカウントとアプリケーションへの SSO アクセスを管理できます。

## 質問52
>会社ではAWSのサーバレスアーキテクチャの利用が進められており、AWS Lambda、API Gateway、およびDynamoDBを単一のスタックで構成した新しいサーバーレスアーキテクチャを実装することになりました。このアプリケーションはJAVAフロントエンドアプリケーションにデータを送信して表示する実装が必要です。 アプリケーションのアクセスがピークに達するとHTTP 504エラーが発生してしまいます。

>この問題の最も可能性の高い原因は次のうちどれですか？

*A: Lambda関数が29秒以上実行されているため、API Gatewayリクエストがタイムアウトした*

***
note:

* APIゲートウェイのHTTP 504エラーはLambda関数がときどき正常に機能しているが、エラーをスローするインスタンスがあることを意味する
* APIゲートウェイのタイムアウト値は 50 ミリ秒〜29 秒の間で設定でき29秒超えているためINTEGRATION_TIMEOUTのエラー

>APIゲートウェイのHTTP 504エラーに関連付けられているゲートウェイ応答タイプは次のとおりです。 <br>
■INTEGRATION_FAILURE：統合が失敗した場合のゲートウェイレスポンス。レスポンスタイプが未指定の場合、このレスポンスはデフォルトで DEFAULT_5XX タイプになります。 <br>
■INTEGRATION_TIMEOUT：統合がタイムアウトした場合のゲートウェイレスポンス。レスポンスタイプが未指定の場合、このレスポンスはデフォルトで DEFAULT_5XX タイプになります

## 質問53
>B社ではAWS Organizationsを使用して、さまざまな部門で使用されている複数のAWSアカウントを統合管理しています。現在、開発部門では開発、テスト、および本番環境向けに３つのAWSアカウントを利用しています。アプリケーションの展開にはCloudFormationテンプレートを使用します。あなたはエンジニアとして、最小限の労力ですべてのAWSアカウントでテンプレートの更新を効果的に管理する必要があります。

>この要件を達成するために必要な対応を選択してください。

*A: CloudFormationのスタックセットを使用して、複数のAWSアカウントのスタックを更新する*

***
note:

* CloudFormationのスタックセットで複数のAWSアカウントとリージョンにリソースを作れる

>CloudFormation テンプレート内に AWS リソースの設定を定義すると、数クリックで複数の AWS アカウントやリージョンにAWSリソースを水平展開できます。クロスアカウントやクロスリージョンのシナリオを解決する AWS 機能のベースラインレベルのセットアップに、この機能を活用できます。一度セットアップしてしまえば、追加のアカウントやリージョンに対しても容易に展開することができます。この機能は、常にクロスアカウントベースで動作します。管理者のアカウントによって、1つ以上のスタックセットが保持されるとともに1つ以上の対象アカウントへのデプロイが制御されます。

## 質問54
>A社はAWSを利用してRubyで記述されたLambda 関数によるサーバレスアプリケーションを構築しています。このLambda関数をデプロイするためにあRubyコード、ライブラリ、および依存関係をデプロイメントパッケージとしてまとめました。このパッケージは50MBですが、解凍されたパッケージは312MBを超えてしまいLambda関数はエラーとなります。

>この問題を解決するために必要な対応を選択してください。

*A: 解凍後のLambda関数のサイズを250MB以下としてアップロードし、余分なファイルを/tmpディレクトリにロードする*

***
note:

* 展開時のサイズは250MBまで
* 余分なファイルは/tmpにロードしそこの制限は512MB

> AWS Lambda では、関数の実行と保存に使用できるコンピューティングおよびストレージリソースの量が制限されます。展開パッケージのサイズ制限は250 MB（解凍され、レイヤーを含む）です。そのため、今回はこのサイズ制限を超えた可能性があります。解決策としては、実行用のLambda関数のサイズを削減してアップロードし、余分なファイルを/ tmpディレクトリにロードするです。/ tmpディレクトリ制限は512 MBです。

## 質問55
>あなたはELBとAuto Scalingグループの背後にあるEC2インスタンスにホストされている一連のWebサーバーとRDSで構成されたアプリケーションをデプロイしました。セッション情報は各アプリケーションインスタンスのメモリに保存されていますが、アプリケーション負荷が高まるとセッション切れが発生してしまうためリファクタリングが必要です。

>これらのセッション情報を外部に保持する構成として最適なソリューションを選択してください。

*A: ElasticCacheクラスターを追加する*

***
note:

* セッションの外部化の対応は2パターン
* 今回はアクセスが増えた場合の対処なのでElasticCacheでセッションを管理するようにすることでスケーラブルなセッション管理ができる

>■スティッキーセッションの使用<br>
デフォルトでは、ELBは負荷が最小の登録されたインスタンスに各リクエストを個別にルーティングします。スティッキーセッション機能 を使用することによって、ロードバランサーがユーザーのセッションを特定のアプリケーションインスタンスにバインドするように設定できます。これにより、ユーザーのセッション中のすべてのリクエストが同じインスタンスに送信されます。 

>■分散キャッシュの使用<br>
スケーラビリティに対処し、個々のWebサーバーからアクセスできるセッションに共有データストレージを提供するために、Webサーバー自体からHTTPセッションを抽象化できます。これに対する一般的なソリューションは、RedisやMemcachedなどのメモリ内キー/値ストアを活用することです。

## 質問62
>会社はSQSキューによるポーリング処理をEC2インスタンスが受け取って処理を効率化するアプリケーションを開発しています。マネージャーは、負荷がかかってもソフトウェアアプリケーションの応答性を維持するために長時間かかるコンポーネントを分離するように求めています。あなたはエンジニアとして、 Elastic Beanstalk設定で動作するようSQSを設定することにしました。   

>この要件を満たすElastic Beanstalk環境設定を選択してください。

*A: ワーカー環境を設定する*

***
note:

* 特に重い処理がある場合にはそれを行うためだけのワーカー環境を構築し、フロントエンドと分離する
* そしてSQSでBeanstalkのワーカー環境のインスタンスのキャパを超えないようにキューを管理し処理をしていく

## 質問63
>あなたは、データベースエンジニアとしてRDSを利用したシステムの開発を行っています。 このシステムでデータベース処理の可用性を確保するには、Amazon CloudWatchのデータベースメトリックスを監視する必要があります。

>Amazon RDS DBインスタンスの拡張モニタリングで取得出来るメトリクスを選択してください。（2つ選択してください。）

*A: RDSChildプロセス（子プロセス),OSプロセス*

***
note:

>拡張モニタリングを実施すると、DBインスタンスが実行されているオペレーティングシステム（OS）のメトリックをリアルタイムで提供します。また、拡張モニタリングによってRDS Childプロセス（子プロセス）のメトリクスも提供されます

## 質問64
>A社はAWSを利用してNode.jsアプリケーションを構築しています。このアプリケーションは十分なログ取得と追跡が必要となっており、 X-Rayコンソール経由で呼び出しを適切にトレースする設定を行って、Elastic Beanstalkで展開しています。Elastic Beanstalkはリソースをプロビジョニングするために別のデプロイサービスに依存して利用されています。

>Elastic Beanstalkがデプロイ時に利用するサービスを選択してください。（２つ選択してください）

*A: CodePipelineとCloudFormation*

***
note:

* Elastic Beanstalk を使用してコードをデプロイするように CodePipeline を設定できる
* ElasticBeanstalkはCloudFormationと互いに補完し合うように設計されている

## 質問65
>あなたの会社では標準のS3バケットでホストされている静的WEBホスティングを利用した会社サイトを運用しています。あなたはソリューションアーキテクトとして、Route 53による新しいWebドメイン名を取得して、この会社サイトに利用したいと考えています。

>Route 53を使用してAmazon S3バケットでホストされているウェブサイトにトラフィックをルーティングする際の前提条件を選択してください。（2つ選択してください。）

*A: ドメインネームとバケットネームが同じでなければならない,登録済みドメインネームがあること*

***
note:

* 静的WebサイトをホストするS3バケットはドメインまたはサブドメインと同じ名前の必要がある
* そしたらそのバケット名がドメインで静的サイトをホストできる
* あるドメインのクライアントWebアプリケーションが別のドメインのリソースと対話する際にだけCross-Origin Resource Sharing（CORS）を有効にする必要がある
